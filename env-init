#!/bin/bash
#
# env-init - Validator operator environment setup
#
# Sets up and deploys validator operator environment with deploy semantics.
# Always ensures the system matches the desired state.
#
# What it does:
# - Cleans up legacy 'arch' user (housekeeping)
# - Creates/updates 'testnet-validator' user  
# - Ensures proper directory structure
# - Always deploys latest resources/run-validator script
#
# Idempotent: Safe to run multiple times
# Dependencies: resources/run-validator must exist
#
set -euo pipefail
source "$(dirname "$0")/common.sh"
cd "$PROJECT_ROOT"

# Cleanup
clobber_user "arch"

# Deploy a testnet validator operator
deploy_validator_operator "testnet-validator"