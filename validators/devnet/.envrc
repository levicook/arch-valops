# Devnet Environment
# Default configuration for devnet operations (bitcoin, titan, validator)
# Services configured in dependency order: Bitcoin → Titan → Arch

source_up

# === BITCOIN CONFIGURATION (Base Layer) ===
export BITCOIN_USER=devnet-bitcoin
export BITCOIN_NETWORK_MODE=regtest
export BITCOIN_RPC_USER=bitcoin
export BITCOIN_PRUNE_SIZE=1000 # Keep ~1GB recent blocks for devnet

# === TITAN CONFIGURATION (Indexer Layer - depends on Bitcoin) ===
export TITAN_USER=devnet-titan
export TITAN_NETWORK_MODE=regtest
# === ARCH/VALIDATOR CONFIGURATION (Application Layer - depends on Bitcoin + Titan) ===
export VALIDATOR_USER=devnet-validator
export ARCH_NETWORK_MODE=devnet

# Validator runtime configuration (with sensible defaults)
export ARCH_DATA_DIR="${ARCH_DATA_DIR:-$(default_data_dir $VALIDATOR_USER)}"
export ARCH_RPC_BIND_IP="${ARCH_RPC_BIND_IP:-127.0.0.1}"
export ARCH_RPC_BIND_PORT="${ARCH_RPC_BIND_PORT:-9002}"

# Titan endpoints (mode-aware using helper functions)
export ARCH_TITAN_MODE=remote # local|remote - whether validator connects to local or remote titan
export ARCH_TITAN_ENDPOINT="${ARCH_TITAN_ENDPOINT:-$(default_titan_endpoint $ARCH_NETWORK_MODE $ARCH_TITAN_MODE)}"
export ARCH_TITAN_SOCKET_ENDPOINT="${ARCH_TITAN_SOCKET_ENDPOINT:-$(default_titan_socket_endpoint $ARCH_NETWORK_MODE $ARCH_TITAN_MODE)}"

# WebSocket configuration (with sensible defaults)
export ARCH_WEBSOCKET_ENABLED="${ARCH_WEBSOCKET_ENABLED:-false}"
export ARCH_WEBSOCKET_BIND_IP="${ARCH_WEBSOCKET_BIND_IP:-127.0.0.1}"
export ARCH_WEBSOCKET_BIND_PORT="${ARCH_WEBSOCKET_BIND_PORT:-8081}"

# Ensure required passwords exist
ensure_dot_env_password_exists BITCOIN_RPC_PASSWORD "$(dirname "${BASH_SOURCE[0]}")"

# Source user customizations
dotenv_if_exists .env
dotenv .env.passwords

# Display environment status
display_environment_status "Devnet" "$VALIDATOR_USER" "$BITCOIN_USER" "$ARCH_NETWORK_MODE" "$BITCOIN_NETWORK_MODE" "$BITCOIN_PRUNE_SIZE" "${ARCH_TITAN_MODE:-remote}" "$ARCH_TITAN_ENDPOINT" "${ARCH_WEBSOCKET_ENABLED:-false}" "${ARCH_WEBSOCKET_BIND_IP:-127.0.0.1}" "${ARCH_WEBSOCKET_BIND_PORT:-8081}"
